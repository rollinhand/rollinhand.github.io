<!-- HTML5 HEADER WITH NAVIGATION -->
<!DOCTYPE html>
<html lang="de">
<head>
  <!-- HTML metadata and includes -->
  <!-- Header information like meta information and script resources -->
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, maximum-scale=1">

  <link rel="icon" href="../../../../../images/favicon.png" type="image/png">
  <link rel="shortcut icon" href="../../../../../images/favicon.png" type="image/png">

  <!-- Stylesheets -->
  <link href="../../../../../css/styles.css" rel="stylesheet" type="text/css">
  <link href="../../../../../css/github.css" rel="stylesheet" type="text/css">
  <!-- Bootstrap icons-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Feeds -->
  <link rel="alternate" type="application/atom+xml" title="Atom" href="../../../../../feed.xml" />

  <!-- Load Highlight.js -->
  <script src="../../../../../js/highlight.pack.js"></script>
  <title>Exception Mapper mit Apache CXF</title>
</head>
<body class="d-flex flex-column h-100">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container px-5">
      <a class="navbar-brand" href="../../../../../index.html"><img class="logo" src="../../../../../images/kivio-white.png" alt="Logo"></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mb-2 mx-1 mb-lg-0">
            <li class="nav-item mx-1 ">
              <a class="nav-link " href="../../../../../category/allgemein/index.html">Allgemein</a>
            </li>
            <li class="nav-item mx-1 ">
              <a class="nav-link " href="../../../../../category/devops/index.html">DevOps</a>
            </li>
            <li class="nav-item mx-1 ">
              <a class="nav-link " href="../../../../../category/entwicklung/index.html">Entwicklung</a>
            </li>
            <li class="nav-item mx-1 ">
              <a class="nav-link " href="../../../../../category/technologie/index.html">Technologie</a>
            </li>
        </ul>
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
<a href="../../../../../about/index.html">
    <img class="avatar avatar-small" alt="rollinhand" width="40" height="40" data-proofer-ignore="true"
         src="https://avatars2.githubusercontent.com/rollinhand?v=3&s=40"
         srcset="https://avatars2.githubusercontent.com/rollinhand?v=3&s=40 1x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=80 2x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=120 3x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=160 4x"/></a>        </ul>
      </div>
    </div>
  </nav>
<main class="flex-shrink-0">
	<!-- Page Content-->
	<section class="py-5">
		<div class="container px-5 my-5">
			<div class="row gx-5">
				<div class="col-lg-3">
					<div class="d-flex align-items-center mt-lg-5 mb-4">
<a href="../../../../../about/index.html">
    <img class="avatar avatar-small" alt="rollinhand" width="40" height="40" data-proofer-ignore="true"
         src="https://avatars2.githubusercontent.com/rollinhand?v=3&s=40"
         srcset="https://avatars2.githubusercontent.com/rollinhand?v=3&s=40 1x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=80 2x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=120 3x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=160 4x"/></a>						<div class="small ms-3">
							<div class="fw-bold">Björn Berg</div>
						</div>
					</div>
					<!-- Hinweis auf fremden Blog-Artikel -->
				</div>
				<div class="col-lg-9">
					<!-- Post content-->
					<article>
						<!-- Post header-->
						<header class="mb-4">
							<!-- Post title-->
							<h1 class="fw-bolder mb-1">Exception Mapper mit Apache CXF</h1>
							<!-- Post meta content-->
							<div class="text-muted fst-italic mb-2">11.06.2020</div>
							<!-- Post categories-->
								<a class="badge bg-primary text-decoration-none link-light" href="/category/entwicklung">Entwicklung</a>
							<!-- Post tags -->
									<span class="badge bg-secondary text-decoration-none link-light">Meecrowave</span>
									<span class="badge bg-secondary text-decoration-none link-light">Apache CXF</span>
									<span class="badge bg-secondary text-decoration-none link-light">REST</span>
						</header>
						<!-- Post content-->
						<section class="mb-5">
							<p>Exception Mapper in Verbindung mit REST-Services vereinfachen nicht nur den Code, sondern sorgen auch dafür, dass Exceptions identisch behandelt und den gleichen Fehlercode an den Aufrufer zurückliefern. In diesem Blog-Beitrag zeige ich, wie das mit <a href="http://cxf.apache.org">Apache CXF</a> und <a href="../../../2020/04/30/meecrowave-microservices-ohne-aufwandiges-framework.html">Meecrowave</a> funktioniert und die Anwendung auch für andere Servlet-Container oder Java EE-Server portabel bleibt.</p>
<!--more-->
<h2>Die individuelle Exception werfen</h2>
<p>Exceptions sind dazu geschaffen worden, einer Methode die Möglichkeit zu bieten, die Verarbeitung umgehend und kontrolliert zu beenden und das &ldquo;Problem&rdquo; an den Aufrufer zu delegieren. Anstatt nun auf die Standard-Exceptions der Sprache Java zu setzen, erweist es sich als Good Practice eigene Exceptions zu definieren, um so die Verarbeitung im eigenen Code gezielter beeinflussen zu können.</p>
<p>Gerade im Domain Driven Design sollten Objekte ihre eigenen Exceptions mitbringen, um in der gemeinsamen Sprachwelt (Ubiquitous Language) zu bleiben.</p>
<p>Bei der Verwendung von REST-Services in einer Anwendung, kann der Service (der Aufgerufene) auch das Problem an den Aufrufer delegieren. Gründe hierfür könnten sein, dass</p>
<ul>
<li>übergebene Parameter nicht plausibel sind,</li>
<li>angeforderte Daten nicht verfügbar sind,</li>
<li>die aufgerufene Aktion auf einen Fehler gelaufen ist.</li>
</ul>
<p>Es lassen sich sicherlich noch viel mehr Gründe finden. Für mein Beispiel greife ich wieder auf den <a href="https://github.com/rollinhand/meecrowave-example">Person-Server</a> zurück, der auch schon im initialen <a href="../../../2020/04/30/meecrowave-microservices-ohne-aufwandiges-framework.html">Blogbeitrag zu Meecrowave</a> herangezogen worden ist.</p>
<p>Im Model ist die Klasse <code>PersonException</code> definiert, die im Backend immer geworfen wird, wenn eine Aktion auf einem Objekt der Klasse <code>Person</code> fehlschlägt. Es handelt sich dabei um eine <code>RuntimeException</code>, sodass diese auch nicht bei jedem Methodenaufruf definiert werden muss.</p>
<h2>Der REST-Endpunkt</h2>
<p>Im Beispiel existiert der REST-Endpunkt <code>PersonEndpoint</code>, der verschiedene Aktionen bzw. Methoden zur Verfügung stellt. Ein Auszug ist im Folgenden dargestellt:</p>
<pre><code class="language-java">@RequestScoped
@Path(&quot;/person&quot;)
public class PersonEndpoint {
  @Inject
  private IPersonService personService;

  @DELETE
  @Path(&quot;/{id}&quot;)
  public Response removeById(@PathParam(&quot;id&quot;) String id) {
    personService.removeById(id);
    return Response.ok().build();
  }
  // snipped other methods
}
</code></pre>
<p>Die Klasse <code>PersonEndpoint</code> delegiert die Aufrufe an eine Implementierung von <code>IPersonService</code> und überlässt dieser die Verarbeitung. Für den weiteren Verlauf des Beispiels beschränke ich mich auf die Methode zum Löschen einer Person über ihre ID. (<code>removeById</code>).</p>
<p>Ist der Aufruf erfolgreich, so wird der HTTP-Status OK (200) an den Aufrufer zurückgeliefert. Aber was passiert, wenn der Aufruf scheitert, weil über die ID keine Person zur Löschung gefunden werden kann? Die Code-Passage im obigen Beispiel lässt auf den ersten Blick vermuten, dass immer OK an den Aufrufer zurückgeliefert wird.</p>
<p>Im ersten Moment kribbelt es in den Fingern, die Code-Passage vielleicht so zu ändern:</p>
<pre><code class="language-java">@DELETE
@Path(&quot;/{id}&quot;)
public Response removeById(@PathParam(&quot;id&quot;) String id) {
  if (personService.removeById(id)) {
    return Response.ok().build();
  } else {
    return Response.notModified().build();
  }	
}
</code></pre>
<p>Schön geht anders und die Zeiten, dass Methoden oder Funktionen ihren Status über Codes oder boolesche Werte mitteilen sind seit der objektorientierten Programmierung und der Einführung von Exceptions vorbei.</p>
<p>Ein Blick auf die Methode <code>removeById</code> im eigentlichen Service bringt mehr Klarheit:</p>
<pre><code class="language-java">@Override
public void removeById(String id) {
  Optional&lt;Person&gt; person = findById(id);

  if (person.isPresent()) {
    log.info(&quot;Removing person {}&quot;, person);
    remove(person.get());
  } else {
    throw new PersonException(&quot;Person with UUID &quot; + id + &quot; not found&quot;);
  }
}
</code></pre>
<p>Kann die Person nicht gefunden werden, so wird die <code>PersonException</code> geworfen. Damit innerhalb des REST-Services keine Catch-Routinen eingeführt werden müssen, existieren im JAX-RS Standard Exception Mapper, die genau diese Rolle übernehmen und dafür sorgen, dass der Code aufgeräumter wirkt und einen aspektorientierten Ansatz bekommt.</p>
<h2>Exception Mapper mit Apache CXF</h2>
<p>Mit <a href="http://cxf.apache.org">Apache CXF</a> lassen sich einfach REST- und SOAP-Services implementieren. Für REST bietet Apache CXF eine JAX-RS konforme Implementierung, sodass sich Exception Mapper definieren und einbinden lassen. Im Beispiel sieht der Exception Mapper wie folgt aus:</p>
<pre><code class="language-java">@Provider
public class PersonExceptionMapper implements ExceptionMapper&lt;PersonException&gt;{
  @Override
  public Response toResponse(PersonException exception) {
    return Response.status(Status.NOT_ACCEPTABLE).entity(exception.getMessage()).build();
  }
}
</code></pre>
<p>Der Mapper sorgt dafür, dass jede im REST-Kontext über den <code>PersonService</code> geworfene <code>PersonException</code> abgefangen und in einen HTTP-Response mit einem einheitlichen Status gepackt wird.</p>
<p>Über die Annotation <em>@Provider</em> definiert der JAX-RS Standard, dass so Erweiterungen bekannt gemacht werden können. Leider interpretiert Apache CXF diese Annotation zum Zeitpunkt dieses Beitrags noch nicht und auch die Implementierung in Meecrowave bietet hierfür noch keine Unterstützung.</p>
<p>Nur mit dieser Code-Passage wird die Exception folglich ungefiltert geworfen und führt zu einem &ldquo;wunderbaren&rdquo; Stack-Trace den wir nicht sehen wollen. Abhilfe lässt sich über die <em>beans.xml</em> schaffen, die je nach Paketierung entweder in den Verzeichnissen WEB-INF oder META-INF abgelegt werden sollte.</p>
<p>Dort kann die Erweiterung Apache CXF bekannt gemacht werden:</p>
<pre><code class="language-xml">&lt;jaxrs:server id=&quot;personServer&quot; address=&quot;/&quot;&gt;
    &lt;jaxrs:serviceBeans&gt;
        &lt;ref bean=&quot;org.kivio.server.endpoints.PersonEndpoint&quot; /&gt;
    &lt;/jaxrs:serviceBeans&gt;
    &lt;jaxrs:providers&gt;
        &lt;bean
            class=&quot;org.kivio.server.endpoints.NullPointerExceptionMapper&quot; /&gt;
        &lt;bean
            class=&quot;org.kivio.server.endpoints.PersonExceptionMapper&quot; /&gt;
    &lt;/jaxrs:providers&gt;
&lt;/jaxrs:server&gt;
</code></pre>
<p>Über die zusätzliche Konfiguration in der <em>beans.xml</em> wird zunächst im Attribut <em>serviceBeans</em> festgelegt, welche Beans REST-Services nach dem JAX-RS Standard sind. Über das Attribut <em>providers</em> werden die Klassen benannt, die Erweiterungen für JAX-RS bieten.</p>
<p>Mit CURL kann die Funktionalität getestet werden:</p>
<pre><code class="language-sh">curl -v -XDELETE http://localhost:8080/person/2020
</code></pre>
<p>Und erhalten als Ausgabe einen sauberen HTTP-Response und keinen Stack-Trace.</p>
<pre><code>&gt; DELETE /person/2020 HTTP/1.1
&gt; Host=localhost:8080
&gt; User-Agent=curl/7.64.1
&gt; Accept=*/*
&gt; 
&lt; HTTP/1.1 406 
&lt; Date=Thu, 11 Jun 2020 14:14:42 GMT
&lt; Content-Type=application/octet-stream
&lt; Content-Length=31
&lt; 
* Connection #0 to host localhost left intact
Person with UUID 2020 not found* Closing connection 0
</code></pre>
<h2>Portabilität</h2>
<p>Wird die Anwendung in einem Java EE-Server betrieben, der keine Apache CXF-Implementierung sondern Jersey oder RESTEasy nutzt, kann die Konfiguration in der <em>beans.xml</em> entfallen.</p>
<h2>Zusammenfassung</h2>
<p>Mit Exception Mappern lässt sich auch in Verbindung mit Apache CXF verständlicher und schlanker Code schreiben. Boilerplate-Code innerhalb des REST-Services wird somit vermieden und Exceptions werden nach außen einheitlich behandelt. Die Idee hinter Exceptions, den Fehler an den Aufrufer zu delegieren wird direkt unterstützt. Auch wenn zusätzliche Konfiguration in der <em>beans.xml</em> notwendig ist, bleibt die Anwendung dennoch portabel.</p>

						</section>
					</article>
					<section>
						<div class="card bg-light">
							<div class="card-body">
								<h5><i class="fa fa-comment"></i> Kommentar</h5>

								<div class="mt-3">
									<p>Du möchtest diskutieren oder einen Kommentar zu dem Beitrag hinterlassen?</p>
									<small class="text-muted">Dieser Blog hat keine öffentliche Kommentarfunktion, aber ich freue mich jederzeit über eine
										<a href="mailto:rollin.hand@gmx.de">Mail</a> mit kritischen Anmerkungen, Feedback oder auch einfach nur
										Lob an meine Mail-Adresse <a href="mailto:rollin.hand@gmx.de">rollin.hand[@]gmx.de</a>.</small>
								</div>
							</div>
						</div>
					</section>
				</div>
			</div>
		</div>
	</section>
</main>
<!-- HTML5 FOOTER -->
<footer class="bg-dark py-4 mt-auto">
    <div class="container px-5">
        <div class="row align-items-center justify-content-between flex-column flex-sm-row">
            <div class="col-auto">
                <div class="small m-0 text-white">Copyright &copy; 2017 - 2025 by Björn Berg</div>
            </div>
            <div class="col-auto">
                <a class="link-light small" href="../../../../../blog/meecrowave.html">Apache Meecrowave</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="../../../../../privacy-policy/index.html">Privacy</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="../../../../../about/index.html">Imprint</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="mailto:rollin.hand@gmx.de">Contact</a>
            </div>
            <div class="col-auto">
                <a class="link-light text-decoration-none mx-1 small" href="https://www.xing.com/profile/Bjoern_Berg2" target="_blank" rel="me">
                    <span class="button xing" aria-details="Xing"><i class="fab fa-xing"></i></span>
                </a>
                <a class="link-light text-decoration-none mx-1 small" href="https://www.linkedin.com/in/bjoernberg82" target="_blank" rel="me">
                    <span class="button linkedin" aria-details="LinkedIn"><i class="fab fa-linkedin"></i></span>
                </a>
                <a class="link-light text-decoration-none mx-1 small" href="../../../../../feed.xml">
                    <span class="button atom" aria-details="Atom/RSS"><i class="fas fa-rss subscribe"></i></span>
                </a>
            </div>
        </div>
    </div>
</footer>
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>