<!-- HTML5 HEADER WITH NAVIGATION -->
<!DOCTYPE html>
<html lang="de">
<head>
  <!-- HTML metadata and includes -->
  <!-- Header information like meta information and script resources -->
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, maximum-scale=1">

  <link rel="icon" href="../../../../../images/favicon.png" type="image/png">
  <link rel="shortcut icon" href="../../../../../images/favicon.png" type="image/png">

  <!-- Stylesheets -->
  <link href="../../../../../css/styles.css" rel="stylesheet" type="text/css">
  <link href="../../../../../css/github.css" rel="stylesheet" type="text/css">
  <!-- Bootstrap icons-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Feeds -->
  <link rel="alternate" type="application/atom+xml" title="Atom" href="../../../../../feed.xml" />

  <!-- Load Highlight.js -->
  <script src="../../../../../js/highlight.pack.js"></script>
  <title>JNI - Exception-Handling unter Windows</title>
</head>
<body class="d-flex flex-column h-100">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container px-5">
      <a class="navbar-brand" href="../../../../../index.html"><img class="logo" src="../../../../../images/kivio-white.png" alt="Logo"></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mb-2 mx-1 mb-lg-0">
            <li class="nav-item mx-1 ">
              <a class="nav-link " href="../../../../../category/allgemein/index.html">Allgemein</a>
            </li>
            <li class="nav-item mx-1 ">
              <a class="nav-link " href="../../../../../category/devops/index.html">DevOps</a>
            </li>
            <li class="nav-item mx-1 ">
              <a class="nav-link " href="../../../../../category/entwicklung/index.html">Entwicklung</a>
            </li>
            <li class="nav-item mx-1 ">
              <a class="nav-link " href="../../../../../category/technologie/index.html">Technologie</a>
            </li>
        </ul>
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
<a href="../../../../../about/index.html">
    <img class="avatar avatar-small" alt="rollinhand" width="40" height="40" data-proofer-ignore="true"
         src="https://avatars2.githubusercontent.com/rollinhand?v=3&s=40"
         srcset="https://avatars2.githubusercontent.com/rollinhand?v=3&s=40 1x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=80 2x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=120 3x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=160 4x"/></a>        </ul>
      </div>
    </div>
  </nav>
<main class="flex-shrink-0">
	<!-- Page Content-->
	<section class="py-5">
		<div class="container px-5 my-5">
			<div class="row gx-5">
				<div class="col-lg-3">
					<div class="d-flex align-items-center mt-lg-5 mb-4">
<a href="../../../../../about/index.html">
    <img class="avatar avatar-small" alt="rollinhand" width="40" height="40" data-proofer-ignore="true"
         src="https://avatars2.githubusercontent.com/rollinhand?v=3&s=40"
         srcset="https://avatars2.githubusercontent.com/rollinhand?v=3&s=40 1x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=80 2x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=120 3x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=160 4x"/></a>						<div class="small ms-3">
							<div class="fw-bold">Björn Berg</div>
						</div>
					</div>
					<!-- Hinweis auf fremden Blog-Artikel -->
				</div>
				<div class="col-lg-9">
					<!-- Post content-->
					<article>
						<!-- Post header-->
						<header class="mb-4">
							<!-- Post title-->
							<h1 class="fw-bolder mb-1">JNI - Exception-Handling unter Windows</h1>
							<!-- Post meta content-->
							<div class="text-muted fst-italic mb-2">13.07.2010</div>
							<!-- Post categories-->
								<a class="badge bg-primary text-decoration-none link-light" href="/category/entwicklung">Entwicklung</a>
							<!-- Post tags -->
						</header>
						<!-- Post content-->
						<section class="mb-5">
							<p>Um Exceptions aus einem JNI-Interface abzufangen und strukturiert behandeln zu können, sind ein paar zusätzliche Handgriffe notwendig. Dieses Post gibt einen kurzen Einblick über die Fallstricke und wie sie umgangen werden können.</p>
<!--more-->
<p>Bei der Programmierung mit dem Java Native Interface und dem Aufruf von Windows API-Funktionen bin ich auf Probleme gestoßen eine Exception abzufangen. Ein Try-Catch-Block war innerhalb von JNI nicht wirklich hilfreich.</p>
<p>Will man in C++ eine Exception abfangen, so definiert man meist einen  Try-Catch-Block. Faule Programmierer schreiben dabei meist  eine Anweisung wie:</p>
<pre><code>try {
	// Eigentlich auszuführender  Funktionsrumpf
} catch(...) {
	// Irgendwie den Fehler behandeln
}
</code></pre>
<p>Das funktioniert so lange gut, wie es sich um Ausnahmen in der eigenen Software handelt. Wird JNI zu Hilfe genommen, um z.B. mittels  Java Zugriff auf native API-Funktionen des Betriebssystems zu erlangen, dann stößt dieser Mechanismus an seine Grenzen und das Programm kann  diesen Fehler bzw. diese Ausnahme nicht behandeln.</p>
<h2>Windows-Mechanismus für Ausnahmen</h2>
<p>Unter Windows wird der mechanismus für die Behandlung von Software- und Hadrware-Ausnahmen als <strong>Structured Exception Handling</strong> (SEH) bezeichnet. Diese stackframe-basierte Ausnahmebehandlung kann mit dem Exceptionhandling in C++ bzw. Java verglichen werden, nutzt aber innerhalb von C++ die Schlüsselwörter __try und __except. Mit diesen Schlüsselwörtern kann man den Codeblock einschließen, bei denen man eine Exception erwartet. Bei der Programmierung mit JNI, sollte man dementsprechend alle Codeblöcke, die einen nativen Call an die Windows  API machen, mit diesem Block-Fragment umschließen:</p>
<pre><code>__try {
	// Code
} __except(expression) {
	// Ausnahmebehandlung
}
</code></pre>
<p>Als <em>expression</em> können die folgenden Werte angegeben werden: <strong>EXCEPTION_CONTINUE_EXECUTION (-1)</strong> Der Handler hat für die  Ausnahmebehandlung gesorgt und nicht der __except-Block.</p>
<p><strong>EXCEPTION_CONTINUE_SEARCH (0)</strong> Der gerade aufgerufene  Handler kann die Ausnahme nicht behandeln und es wird auf den nächsten Handler gewartet bzw. danach gesucht. Diese Anweisung kann unter C++ / Java mit dem Umstand beschrieben werden, dass in einem Catch-Block eine Exception aufgetreten ist, die nicht durch den Block abgefangen wird.</p>
<p><strong>EXCEPTION_EXECUTE_HANDLER (1)</strong> Der __except-Block wird  ausgeführt.</p>
<p>Unter Windows sind die Konsole-Events und die Applikations-Threads asynchron. Die C-Runtime-Bibliothek ist dafür zuständig die auf der Konsole auftretenden Ereignisse mit den Windows-Ausnahmen zu gültigen Signalen zu vereinen. Bei der Softwareentwicklung mittels JNI, sollten also alle Windows API-Aufrufe in einen __try und __except-Block gepackt werden, damit fehlerhafte Aufrufe an die API abgefangen werden können und an die höher gelegenen Schichten wie die Konsole oder die Java-Anwendung (in Form  einer Exception) weiter gereicht werden können.</p>

						</section>
					</article>
					<section>
						<div class="card bg-light">
							<div class="card-body">
								<h5><i class="fa fa-comment"></i> Kommentar</h5>

								<div class="mt-3">
									<p>Du möchtest diskutieren oder einen Kommentar zu dem Beitrag hinterlassen?</p>
									<small class="text-muted">Dieser Blog hat keine öffentliche Kommentarfunktion, aber ich freue mich jederzeit über eine
										<a href="mailto:rollin.hand@gmx.de">Mail</a> mit kritischen Anmerkungen, Feedback oder auch einfach nur
										Lob an meine Mail-Adresse <a href="mailto:rollin.hand@gmx.de">rollin.hand[@]gmx.de</a>.</small>
								</div>
							</div>
						</div>
					</section>
				</div>
			</div>
		</div>
	</section>
</main>
<!-- HTML5 FOOTER -->
<footer class="bg-dark py-4 mt-auto">
    <div class="container px-5">
        <div class="row align-items-center justify-content-between flex-column flex-sm-row">
            <div class="col-auto">
                <div class="small m-0 text-white">Copyright &copy; 2017 - 2025 by Björn Berg (Last update: 2025-02-17)</div>
            </div>
            <div class="col-auto">
                <a class="link-light small" href="../../../../../blog/meecrowave.html">Apache Meecrowave</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="../../../../../privacy-policy/index.html">Privacy</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="../../../../../about/index.html">Imprint</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="mailto:rollin.hand@gmx.de">Contact</a>
            </div>
            <div class="col-auto">
                <a class="link-light text-decoration-none mx-1 small" href="https://www.xing.com/profile/Bjoern_Berg2" target="_blank" rel="me">
                    <span class="button xing" aria-details="Xing"><i class="fab fa-xing"></i></span>
                </a>
                <a class="link-light text-decoration-none mx-1 small" href="https://www.linkedin.com/in/bjoernberg82" target="_blank" rel="me">
                    <span class="button linkedin" aria-details="LinkedIn"><i class="fab fa-linkedin"></i></span>
                </a>
                <a class="link-light text-decoration-none mx-1 small" href="../../../../../feed.xml">
                    <span class="button atom" aria-details="Atom/RSS"><i class="fas fa-rss subscribe"></i></span>
                </a>
            </div>
        </div>
    </div>
</footer>
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>