<!-- HTML5 HEADER WITH NAVIGATION -->
<!DOCTYPE html>
<html lang="de">
<head>
  <!-- HTML metadata and includes -->
  <!-- Header information like meta information and script resources -->
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, maximum-scale=1">

  <link rel="icon" href="../../../../../images/favicon.png" type="image/png">
  <link rel="shortcut icon" href="../../../../../images/favicon.png" type="image/png">

  <!-- Stylesheets -->
  <link href="../../../../../css/styles.css" rel="stylesheet" type="text/css">
  <link href="../../../../../css/github.css" rel="stylesheet" type="text/css">
  <!-- Bootstrap icons-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Feeds -->
  <link rel="alternate" type="application/atom+xml" title="Atom" href="../../../../../feed.xml" />

  <!-- Load Highlight.js -->
  <script src="../../../../../js/highlight.pack.js"></script>
  <title>Glassfish-Server hinter einem Proxy betreiben</title>
</head>
<body class="d-flex flex-column h-100">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container px-5">
      <a class="navbar-brand" href="../../../../../index.html"><img class="logo" src="../../../../../images/kivio-white.png" alt="Logo"></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mb-2 mx-1 mb-lg-0">
            <li class="nav-item mx-1 ">
              <a class="nav-link " href="../../../../../category/allgemein/index.html">Allgemein</a>
            </li>
            <li class="nav-item mx-1 ">
              <a class="nav-link " href="../../../../../category/devops/index.html">DevOps</a>
            </li>
            <li class="nav-item mx-1 ">
              <a class="nav-link " href="../../../../../category/entwicklung/index.html">Entwicklung</a>
            </li>
            <li class="nav-item mx-1 ">
              <a class="nav-link " href="../../../../../category/technologie/index.html">Technologie</a>
            </li>
        </ul>
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
<a href="../../../../../about/index.html">
    <img class="avatar avatar-small" alt="rollinhand" width="40" height="40" data-proofer-ignore="true"
         src="https://avatars2.githubusercontent.com/rollinhand?v=3&s=40"
         srcset="https://avatars2.githubusercontent.com/rollinhand?v=3&s=40 1x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=80 2x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=120 3x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=160 4x"/></a>        </ul>
      </div>
    </div>
  </nav>
<main class="flex-shrink-0">
	<!-- Page Content-->
	<section class="py-5">
		<div class="container px-5 my-5">
			<div class="row gx-5">
				<div class="col-lg-3">
					<div class="d-flex align-items-center mt-lg-5 mb-4">
<a href="../../../../../about/index.html">
    <img class="avatar avatar-small" alt="rollinhand" width="40" height="40" data-proofer-ignore="true"
         src="https://avatars2.githubusercontent.com/rollinhand?v=3&s=40"
         srcset="https://avatars2.githubusercontent.com/rollinhand?v=3&s=40 1x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=80 2x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=120 3x, https://avatars2.githubusercontent.com/rollinhand?v=3&s=160 4x"/></a>						<div class="small ms-3">
							<div class="fw-bold">Björn Berg</div>
						</div>
					</div>
					<!-- Hinweis auf fremden Blog-Artikel -->
				</div>
				<div class="col-lg-9">
					<!-- Post content-->
					<article>
						<!-- Post header-->
						<header class="mb-4">
							<!-- Post title-->
							<h1 class="fw-bolder mb-1">Glassfish-Server hinter einem Proxy betreiben</h1>
							<!-- Post meta content-->
							<div class="text-muted fst-italic mb-2">15.01.2016</div>
							<!-- Post categories-->
								<a class="badge bg-primary text-decoration-none link-light" href="/category/technologie">Technologie</a>
							<!-- Post tags -->
						</header>
						<!-- Post content-->
						<section class="mb-5">
							<p>Wie nutzt man den NGINX effizient als Proxy für einen Glassfish und wie bekommt man den Port 8080 dauerhaft aus Links seiner Web-Anwendung entfernt? Die Antworten liefert dieser Beitrag.</p>
<!--more-->
Der NGINX Webserver ist ein kleiner, schlanker Webserver, der sich hervorragend als Proxy-Server 
für einen schwergewichtigen Applikationsserver wie den Glassfish nutzen lässt. Einen 
Proxy-Server vor einen Applikationsserver soll zum einen dafür sorgen, den Applikationsserver 
abzusichern aber auch statische Inhalte schneller auszuliefern.
<p>Mit einem Proxy-Server ist es somit möglich alle Anfragen über den Port 80 an den Applikationsserver weiterzuleiten und auch ein URL-Rewriting vorzunehmen. Beides war notwendig als ich Apache Roller für meine neue Domain <a href="http://www.kivio.org">www.kivio.org</a> einsetzen wollte. Und das waren die Bedingungen, die NGINX als Proxy erfüllen sollte:</p>
<ul>
<li>Alle Aufrufe sollten über den Port 80 laufen, sodass der Well-known Port 8080 durch die Firewall geschützt werden kann und die Requests intern auf dem Server weitergereicht werden.</li>
<li>Apache Roller erstellt Blog-URLs nach dem Schema <a href="http://domain/roller/">http://domain/roller/</a><em>blog-name.</em> Natürlich sollten die Inhalte der Frontpage bzw. des primären Blog natürlich über <a href="http://www.kivio.org">www.kivio.org</a> erreichbar sein.</li>
<li>Die Anfragen an die alte Domain <a href="http://www.berg-systeme.de">www.berg-systeme.de</a> sollten auf eine vordefinierte, statische Landing-Page geroutet werden.</li>
</ul>
<p>Mit diesen Bedingungen im Hinterkopf, war die Erstkonfiguration schnell erledigt.</p>
<p>In der Konfigurationsdatei /etc/nginx/sites-available/default habe ich folgende Anpassungen vorgenommen:</p>
<pre><code>server {
   listen 80 default_server;
   listen [::]:80 default_server ipv6only=on;

   index index.html index.htm;

   # Make site accessible from http://localhost/
   server_name www.kivio.org www.kivio.biz www.kivio.eu;

   location / {
        proxy_pass http://www.kivio.org:8080/;
   }
}
</code></pre>
<p>Nach einem Neustart des NGINX bzw. einem Neueinlesen der Konfiguration mittels /etc/init.d/nginx reload werden alle Anfragen auf die Startseite des Glassfish-Servers weitergeleitet. Mit Aufruf der URL <a href="http://www.kivio.org/roller/blog">www.kivio.org/roller/blog</a> passierte es allerdings, dass alle erzeugten Links und verlinkten Ressourcen in der Anwendung immer noch den Port 8080 beinhaltet haben. Sobald der Port gesperrt werden würde, wäre es natürlich nicht möglich die Ressourcen wie CSS oder JavaScript zu laden, geschweige denn die verlinkten Seiten zu besuchen.</p>
<h3>Was also tun?</h3>
<p>Der Virtaul Server des Glassfish schafft hier Abhilfe. Er muss eh noch konfiguriert werden, sodass Apache Roller immer als Standardanwendung geladen wird, wenn ein Besucher die URL einfach aufruft.</p>
<p>Über die Admin Konsole kann unter <strong>Configurations &gt; server-config &gt; Virtual Servers</strong> die Konfiguration geändert werden. Unter server sind die Konfigurationen für HTTP-Requests (http-listener-1) und HTTPS-Requests (http-listener-2) zusammengefasst.</p>
<p>Über <strong>Default Web Module</strong> kann festgelegt werden, welche bereitgestellte Anwendung standardmäßig genutzt werden soll.</p>
<p>Da über den http-listener-1 die einfachen HTTP-Anfragen einlaufen, muss dieser nun auch noch konfiguriert werden. Über HTTP-Service &gt; Http Listeners &gt; http-listener-1 kann ein Alias-Name für den Rücktransfer der Daten an den Client festgelegt werden.</p>
<p>Unter <strong>Server Name</strong> wird einfach <a href="http://www.kivio.org:80">www.kivio.org:80</a> eingetragen und der Glassfish neu gestartet.</p>
<p>Nach dem Neustart ist der Port aus allen URL-Angaben verschwunden.</p>
<p>Fehlt also nur noch die Erfüllung der Anforderung für die statische Weiterleitung von <a href="http://www.berg-systeme.de">www.berg-systeme.de</a>.</p>
<h3>Statische Weiterleitung</h3>
<p>Die statische Weiterleitung auf die Landing page ist nach den vorherigen Anpassungen kein Problem mehr. Damit der NGINX auf die Domäne <a href="http://www.berg-systeme.de">www.berg-systeme.de</a> reagiert wird eine eigene Server-Passage in die Konfigurationsdatei eingefügt:</p>
<pre><code>server {
   listen 80;
   server_name www.berg-systeme.de;

   location / {
      proxy_pass http://localhost:8080/roller/kivio/page/de/bergsysteme;
      break;
   }
}
</code></pre>
<p>Damit findet eine transparente Weiterleitung statt.</p>

						</section>
					</article>
					<section>
						<div class="card bg-light">
							<div class="card-body">
								<h5><i class="fa fa-comment"></i> Kommentar</h5>

								<div class="mt-3">
									<p>Du möchtest diskutieren oder einen Kommentar zu dem Beitrag hinterlassen?</p>
									<small class="text-muted">Dieser Blog hat keine öffentliche Kommentarfunktion, aber ich freue mich jederzeit über eine
										<a href="mailto:rollin.hand@gmx.de">Mail</a> mit kritischen Anmerkungen, Feedback oder auch einfach nur
										Lob an meine Mail-Adresse <a href="mailto:rollin.hand@gmx.de">rollin.hand[@]gmx.de</a>.</small>
								</div>
							</div>
						</div>
					</section>
				</div>
			</div>
		</div>
	</section>
</main>
<!-- HTML5 FOOTER -->
<footer class="bg-dark py-4 mt-auto">
    <div class="container px-5">
        <div class="row align-items-center justify-content-between flex-column flex-sm-row">
            <div class="col-auto">
                <div class="small m-0 text-white">Copyright &copy; 2017 - 2025 by Björn Berg (Last update: 2025-02-28)</div>
            </div>
            <div class="col-auto">
                <a class="link-light small" href="../../../../../blog/meecrowave.html">Apache Meecrowave</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="../../../../../privacy-policy/index.html">Privacy</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="../../../../../about/index.html">Imprint</a>
                <span class="text-white mx-1">&middot;</span>
                <a class="link-light small" href="mailto:rollin.hand@gmx.de">Contact</a>
            </div>
            <div class="col-auto">
                <a class="link-light text-decoration-none mx-1 small" href="https://www.xing.com/profile/Bjoern_Berg2" target="_blank" rel="me">
                    <span class="button xing" aria-details="Xing"><i class="fab fa-xing"></i></span>
                </a>
                <a class="link-light text-decoration-none mx-1 small" href="https://www.linkedin.com/in/bjoernberg82" target="_blank" rel="me">
                    <span class="button linkedin" aria-details="LinkedIn"><i class="fab fa-linkedin"></i></span>
                </a>
                <a class="link-light text-decoration-none mx-1 small" href="../../../../../feed.xml">
                    <span class="button atom" aria-details="Atom/RSS"><i class="fas fa-rss subscribe"></i></span>
                </a>
            </div>
        </div>
    </div>
</footer>
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>